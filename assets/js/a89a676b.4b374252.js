"use strict";(self.webpackChunkcrystal_docs=self.webpackChunkcrystal_docs||[]).push([[9622],{6875:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>c,metadata:()=>p,toc:()=>r});var s=e(5893),o=e(1151);const c={},i="\u6e90\u7801\u89e3\u6790",p={id:"scaffold/locate_path",title:"locate_path",description:"\u5224\u65ad\u67d0\u4e2a\u6587\u4ef6\u540d\u79f0(\u5e26\u540e\u7f00)\u6570\u7ec4\u4e2d\u662f\u5426\u6709\u4e00\u4e2a\u6587\u4ef6\u662f\u5426\u5728\u67d0\u4e2a\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u5728\uff0c\u5219\u8fd4\u56de\u8fd9\u4e2a\u6587\u4ef6\u540d\u79f0(\u5e26\u540e\u7f00)\uff0c\u5982\u679c\u4e0d\u5728\u5219\u8fd4\u56de undefined",source:"@site/docs/scaffold/locate_path.md",sourceDirName:"scaffold",slug:"/scaffold/locate_path",permalink:"/docs/scaffold/locate_path",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"find_up",permalink:"/docs/scaffold/find_up"},next:{title:"resolve_cwd",permalink:"/docs/scaffold/resolve_cwd"}},a={},r=[{value:"1. \u5b9a\u4e49\u5e76\u68c0\u67e5\u4e86 options \u7684 type",id:"1-\u5b9a\u4e49\u5e76\u68c0\u67e5\u4e86-options-\u7684-type",level:2},{value:"2. \u904d\u5386\u67e5\u627e\u76ee\u5f55\u4e2d\u662f\u5426\u5b58\u5728\u6587\u4ef6",id:"2-\u904d\u5386\u67e5\u627e\u76ee\u5f55\u4e2d\u662f\u5426\u5b58\u5728\u6587\u4ef6",level:2}];function l(n){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"\u5224\u65ad\u67d0\u4e2a\u6587\u4ef6\u540d\u79f0(\u5e26\u540e\u7f00)\u6570\u7ec4\u4e2d\u662f\u5426\u6709\u4e00\u4e2a\u6587\u4ef6\u662f\u5426\u5728\u67d0\u4e2a\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u5728\uff0c\u5219\u8fd4\u56de\u8fd9\u4e2a\u6587\u4ef6\u540d\u79f0(\u5e26\u540e\u7f00)\uff0c\u5982\u679c\u4e0d\u5728\u5219\u8fd4\u56de undefined"}),"\n"]}),"\n",(0,s.jsx)(t.h1,{id:"\u6e90\u7801\u89e3\u6790",children:"\u6e90\u7801\u89e3\u6790"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:'"use strict";\nconst path = require("path");\nconst fs = require("fs");\nconst { promisify } = require("util");\nconst pLocate = require("p-locate");\n\nconst fsStat = promisify(fs.stat);\nconst fsLStat = promisify(fs.lstat);\n\nconst typeMappings = {\n  directory: "isDirectory",\n  file: "isFile",\n};\n\nfunction checkType({ type }) {\n  if (type in typeMappings) {\n    return;\n  }\n\n  throw new Error(`Invalid type specified: ${type}`);\n}\n\nconst matchType = (type, stat) =>\n  type === undefined || stat[typeMappings[type]]();\n\nmodule.exports = async (paths, options) => {\n  options = {\n    cwd: process.cwd(),\n    type: "file",\n    allowSymlinks: true,\n    ...options,\n  };\n  checkType(options);\n  const statFn = options.allowSymlinks ? fsStat : fsLStat;\n\n  return pLocate(\n    paths,\n    async (path_) => {\n      try {\n        const stat = await statFn(path.resolve(options.cwd, path_));\n        return matchType(options.type, stat);\n      } catch (_) {\n        return false;\n      }\n    },\n    options\n  );\n};\n\nmodule.exports.sync = (paths, options) => {\n  options = {\n    cwd: process.cwd(),\n    allowSymlinks: true,\n    type: "file",\n    ...options,\n  };\n  checkType(options);\n  const statFn = options.allowSymlinks ? fs.statSync : fs.lstatSync;\n\n  for (const path_ of paths) {\n    try {\n      const stat = statFn(path.resolve(options.cwd, path_));\n\n      if (matchType(options.type, stat)) {\n        return path_;\n      }\n    } catch (_) {}\n  }\n};\n'})}),"\n",(0,s.jsxs)(t.p,{children:["\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u540c\u6b65 ",(0,s.jsx)(t.code,{children:".sync"})," \u7684\u6e90\u7801\u90e8\u5206"]}),"\n",(0,s.jsx)(t.h2,{id:"1-\u5b9a\u4e49\u5e76\u68c0\u67e5\u4e86-options-\u7684-type",children:"1. \u5b9a\u4e49\u5e76\u68c0\u67e5\u4e86 options \u7684 type"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"const typeMappings = {\n\tdirectory: 'isDirectory',\n\tfile: 'isFile'\n};\n\nfunction checkType({type}) {\n\tif (type in typeMappings) {\n\t\treturn;\n\t}\n\n\tthrow new Error(`Invalid type specified: ${type}`);\n}\n\n...\noptions = {\n  cwd: process.cwd(),\n  allowSymlinks: true,\n  type: 'file',\n  ...options\n};\ncheckType(options);\n"})}),"\n",(0,s.jsx)(t.p,{children:"\u68c0\u67e5 type \u662f\u5426\u5728 typeMappings \u4e2d\u5b58\u5728\uff0c\u5426\u5219\u7206\u51fa\u9519\u8bef"}),"\n",(0,s.jsx)(t.h2,{id:"2-\u904d\u5386\u67e5\u627e\u76ee\u5f55\u4e2d\u662f\u5426\u5b58\u5728\u6587\u4ef6",children:"2. \u904d\u5386\u67e5\u627e\u76ee\u5f55\u4e2d\u662f\u5426\u5b58\u5728\u6587\u4ef6"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"const matchType = (type, stat) =>\n  type === undefined || stat[typeMappings[type]]();\nconst statFn = options.allowSymlinks ? fs.statSync : fs.lstatSync;\n\nfor (const path_ of paths) {\n  try {\n    const stat = statFn(path.resolve(options.cwd, path_));\n\n    if (matchType(options.type, stat)) {\n      return path_;\n    }\n  } catch (_) {}\n}\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u904d\u5386\u4f20\u5165\u7684\u8def\u5f84"}),"\n",(0,s.jsx)(t.li,{children:"\u89e3\u6790\u4f20\u5165\u7684\u8def\u5f84\u4e0e\u5f53\u524d\u904d\u5386\u8def\u5f84\u4e3a\u7edd\u5bf9\u8def\u5f84"}),"\n",(0,s.jsxs)(t.li,{children:["\u901a\u8fc7",(0,s.jsx)(t.a,{href:"https://nodejs.cn/api/fs.html#fsstatsyncpath-options",children:(0,s.jsx)(t.code,{children:"fs.statSync"})})," \u6216\u8005",(0,s.jsx)(t.code,{children:"fs.lstatSync"})," \u65b9\u6cd5\u83b7\u53d6\u6587\u4ef6\u4fe1\u606f\u72b6\u6001"]}),"\n",(0,s.jsx)(t.li,{children:"\u5224\u65ad\u6587\u4ef6\u540d\u79f0(\u5e26\u540e\u7f00)\u6570\u7ec4\u4e2d\u662f\u5426\u6709\u4e00\u4e2a\u6587\u4ef6\u662f\u5426\u5728\u67d0\u4e2a\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u5728\uff0c\u5219\u8fd4\u56de\u8fd9\u4e2a\u6587\u4ef6\u540d\u79f0(\u5e26\u540e\u7f00)\uff0c\u5982\u679c\u4e0d\u5728\u5219\u8fd4\u56de undefined"}),"\n"]})]})}function d(n={}){const{wrapper:t}={...(0,o.a)(),...n.components};return t?(0,s.jsx)(t,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}},1151:(n,t,e)=>{e.d(t,{Z:()=>p,a:()=>i});var s=e(7294);const o={},c=s.createContext(o);function i(n){const t=s.useContext(c);return s.useMemo((function(){return"function"==typeof n?n(t):{...t,...n}}),[t,n])}function p(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:i(n.components),s.createElement(c.Provider,{value:t},n.children)}}}]);