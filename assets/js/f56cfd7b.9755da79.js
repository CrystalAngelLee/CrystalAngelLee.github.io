"use strict";(self.webpackChunkcrystal_docs=self.webpackChunkcrystal_docs||[]).push([[3056],{3384:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var s=t(5893),o=t(1151);const r={},a="Module._resolveFilename \u6e90\u7801\u89e3\u6790",i={id:"nodejs/module_resolve_filename",title:"Module._resolveFilename \u6e90\u7801\u89e3\u6790",description:"\u6267\u884c\u6d41\u7a0b",source:"@site/docs/nodejs/module_resolve_filename.md",sourceDirName:"nodejs",slug:"/nodejs/module_resolve_filename",permalink:"/docs/nodejs/module_resolve_filename",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Module._nodeModulePaths\u6e90\u7801\u89e3\u6790",permalink:"/docs/nodejs/module_node_module_paths"},next:{title:"Module._resolveLookupPaths \u6e90\u7801\u89e3\u6790",permalink:"/docs/nodejs/module_resolve_lookup_paths"}},l={},p=[{value:"\u6267\u884c\u6d41\u7a0b",id:"\u6267\u884c\u6d41\u7a0b",level:2},{value:"1. \u5224\u65ad\u662f\u5426\u4e3a\u5185\u7f6e\u6a21\u5757 &amp; \u5224\u65adoptions",id:"1-\u5224\u65ad\u662f\u5426\u4e3a\u5185\u7f6e\u6a21\u5757--\u5224\u65adoptions",level:2},{value:"2. \u67e5\u627e\u66f4\u5168\u7684path",id:"2-\u67e5\u627e\u66f4\u5168\u7684path",level:2},{value:"3. \u89e3\u6790\u771f\u5b9e\u8def\u5f84",id:"3-\u89e3\u6790\u771f\u5b9e\u8def\u5f84",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"module_resolvefilename-\u6e90\u7801\u89e3\u6790",children:"Module._resolveFilename \u6e90\u7801\u89e3\u6790"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'Module._resolveFilename = function (request, parent, isMain, options) {\n  if (\n    StringPrototypeStartsWith(request, "node:") ||\n    NativeModule.canBeRequiredByUsers(request)\n  ) {\n    return request;\n  }\n\n  let paths;\n\n  if (typeof options === "object" && options !== null) {\n    if (ArrayIsArray(options.paths)) {\n      const isRelative =\n        StringPrototypeStartsWith(request, "./") ||\n        StringPrototypeStartsWith(request, "../") ||\n        (isWindows && StringPrototypeStartsWith(request, ".\\\\")) ||\n        StringPrototypeStartsWith(request, "..\\\\");\n\n      if (isRelative) {\n        paths = options.paths;\n      } else {\n        const fakeParent = new Module("", null);\n\n        paths = [];\n\n        for (let i = 0; i < options.paths.length; i++) {\n          const path = options.paths[i];\n          fakeParent.paths = Module._nodeModulePaths(path);\n          const lookupPaths = Module._resolveLookupPaths(request, fakeParent);\n\n          for (let j = 0; j < lookupPaths.length; j++) {\n            if (!ArrayPrototypeIncludes(paths, lookupPaths[j]))\n              ArrayPrototypePush(paths, lookupPaths[j]);\n          }\n        }\n      }\n    } else if (options.paths === undefined) {\n      paths = Module._resolveLookupPaths(request, parent);\n    } else {\n      throw new ERR_INVALID_OPT_VALUE("options.paths", options.paths);\n    }\n  } else {\n    paths = Module._resolveLookupPaths(request, parent);\n  }\n\n  if (parent && parent.filename) {\n    if (request[0] === "#") {\n      const pkg = readPackageScope(parent.filename) || {};\n      if (\n        pkg.data &&\n        pkg.data.imports !== null &&\n        pkg.data.imports !== undefined\n      ) {\n        try {\n          return finalizeEsmResolution(\n            packageImportsResolve(\n              request,\n              pathToFileURL(parent.filename),\n              cjsConditions\n            ),\n            request,\n            parent.filename,\n            pkg.path\n          );\n        } catch (e) {\n          if (e.code === "ERR_MODULE_NOT_FOUND")\n            throw createEsmNotFoundErr(request);\n          throw e;\n        }\n      }\n    }\n  }\n\n  // Try module self resolution first\n  const parentPath = trySelfParentPath(parent);\n  const selfResolved = trySelf(parentPath, request);\n  if (selfResolved) {\n    const cacheKey =\n      request +\n      "\\x00" +\n      (paths.length === 1 ? paths[0] : ArrayPrototypeJoin(paths, "\\x00"));\n    Module._pathCache[cacheKey] = selfResolved;\n    return selfResolved;\n  }\n\n  // Look up the filename first, since that\'s the cache key.\n  const filename = Module._findPath(request, paths, isMain, false);\n  if (filename) return filename;\n  const requireStack = [];\n  for (let cursor = parent; cursor; cursor = cursor.parent) {\n    ArrayPrototypePush(requireStack, cursor.filename || cursor.id);\n  }\n  let message = `Cannot find module \'${request}\'`;\n  if (requireStack.length > 0) {\n    message =\n      message +\n      "\\nRequire stack:\\n- " +\n      ArrayPrototypeJoin(requireStack, "\\n- ");\n  }\n  // eslint-disable-next-line no-restricted-syntax\n  const err = new Error(message);\n  err.code = "MODULE_NOT_FOUND";\n  err.requireStack = requireStack;\n  throw err;\n};\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u6267\u884c\u6d41\u7a0b",children:"\u6267\u884c\u6d41\u7a0b"}),"\n",(0,s.jsx)(n.h2,{id:"1-\u5224\u65ad\u662f\u5426\u4e3a\u5185\u7f6e\u6a21\u5757--\u5224\u65adoptions",children:"1. \u5224\u65ad\u662f\u5426\u4e3a\u5185\u7f6e\u6a21\u5757 & \u5224\u65adoptions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'if (\n    StringPrototypeStartsWith(request, "node:") ||\n    NativeModule.canBeRequiredByUsers(request)\n  ) {\n    return request;\n  }\n\nif (typeof options === "object" && options !== null) {\n    if (ArrayIsArray(options.paths)) {\n      const isRelative =\n        StringPrototypeStartsWith(request, "./") ||\n        StringPrototypeStartsWith(request, "../") ||\n        (isWindows && StringPrototypeStartsWith(request, ".\\\\")) ||\n        StringPrototypeStartsWith(request, "..\\\\");\n\n      if (isRelative) {\n        paths = options.paths;\n      } else {\n        const fakeParent = new Module("", null);\n\n        paths = [];\n\n        for (let i = 0; i < options.paths.length; i++) {\n          const path = options.paths[i];\n          fakeParent.paths = Module._nodeModulePaths(path);\n          const lookupPaths = Module._resolveLookupPaths(request, fakeParent);\n\n          for (let j = 0; j < lookupPaths.length; j++) {\n            if (!ArrayPrototypeIncludes(paths, lookupPaths[j]))\n              ArrayPrototypePush(paths, lookupPaths[j]);\n          }\n        }\n      }\n    } else if (options.paths === undefined) {\n      paths = Module._resolveLookupPaths(request, parent);\n    } else {\n      throw new ERR_INVALID_OPT_VALUE("options.paths", options.paths);\n    }\n  }\n'})}),"\n",(0,s.jsx)(n.h2,{id:"2-\u67e5\u627e\u66f4\u5168\u7684path",children:"2. \u67e5\u627e\u66f4\u5168\u7684path"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"paths = Module._resolveLookupPaths(request, parent);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"Module._resolveLookupPaths"})," \u67e5\u627e\u66f4\u5168\u7684\u8def\u5f84"]}),"\n",(0,s.jsx)(n.h2,{id:"3-\u89e3\u6790\u771f\u5b9e\u8def\u5f84",children:"3. \u89e3\u6790\u771f\u5b9e\u8def\u5f84"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const filename = Module._findPath(request, paths, isMain, false);\nif (filename) return filename;\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u89e3\u6790\u5230\u771f\u5b9e\u7684\u8def\u5f84\u8fd4\u56de\u8def\u5f84"})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>i,a:()=>a});var s=t(7294);const o={},r=s.createContext(o);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);