"use strict";(self.webpackChunkcrystal_docs=self.webpackChunkcrystal_docs||[]).push([[669],{1186:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>i,contentTitle:()=>t,default:()=>u,frontMatter:()=>s,metadata:()=>d,toc:()=>c});var n=r(5893),l=r(1151);const s={},t="\u6e90\u7801\u89e3\u6790",d={id:"scaffold/resolve_from",title:"resolve_from",description:"Resolve the path of a module like require.resolve() but from a given path",source:"@site/docs/scaffold/resolve_from.md",sourceDirName:"scaffold",slug:"/scaffold/resolve_from",permalink:"/docs/scaffold/resolve_from",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"resolve_cwd",permalink:"/docs/scaffold/resolve_cwd"},next:{title:"Systemjs",permalink:"/docs/systemjs"}},i={},c=[{value:"1. \u8ba1\u7b97\u7ed9\u5b9a\u8def\u5f84\u7684\u89c4\u8303\u8def\u5f84\u540d",id:"1-\u8ba1\u7b97\u7ed9\u5b9a\u8def\u5f84\u7684\u89c4\u8303\u8def\u5f84\u540d",level:2},{value:"2. \u83b7\u53d6\u6240\u6709\u53ef\u80fd\u7684 node_modules \u8def\u5f84",id:"2-\u83b7\u53d6\u6240\u6709\u53ef\u80fd\u7684-node_modules-\u8def\u5f84",level:2},{value:"3. \u83b7\u53d6\u7edd\u5bf9\u8def\u5f84",id:"3-\u83b7\u53d6\u7edd\u5bf9\u8def\u5f84",level:2},{value:"\u9644\uff1aModule._nodeModulePaths \u548c Module._resolveFilename \u7684\u6267\u884c\u6d41\u7a0b",id:"\u9644module_nodemodulepaths-\u548c-module_resolvefilename-\u7684\u6267\u884c\u6d41\u7a0b",level:2}];function a(e){const o={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,l.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:["Resolve the path of a module like ",(0,n.jsx)(o.a,{href:"https://nodejs.org/api/globals.html#globals_require_resolve",children:(0,n.jsx)(o.code,{children:"require.resolve()"})})," but from a given path"]}),"\n"]}),"\n",(0,n.jsx)(o.h1,{id:"\u6e90\u7801\u89e3\u6790",children:"\u6e90\u7801\u89e3\u6790"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-js",children:'"use strict";\nconst path = require("path");\nconst Module = require("module");\nconst fs = require("fs");\n\nconst resolveFrom = (fromDirectory, moduleId, silent) => {\n  if (typeof fromDirectory !== "string") {\n    throw new TypeError(\n      `Expected \\`fromDir\\` to be of type \\`string\\`, got \\`${typeof fromDirectory}\\``\n    );\n  }\n\n  if (typeof moduleId !== "string") {\n    throw new TypeError(\n      `Expected \\`moduleId\\` to be of type \\`string\\`, got \\`${typeof moduleId}\\``\n    );\n  }\n\n  try {\n    fromDirectory = fs.realpathSync(fromDirectory);\n  } catch (error) {\n    if (error.code === "ENOENT") {\n      fromDirectory = path.resolve(fromDirectory);\n    } else if (silent) {\n      return;\n    } else {\n      throw error;\n    }\n  }\n\n  // \u8fd9\u91cc\u4e0d\u4f1a\u5f71\u54cd\u4ee3\u7801\u6267\u884c => \u53ef\u4ee5\u4f20\u5165\u4efb\u610f\u6587\u4ef6\u540d\u79f0\n  const fromFile = path.join(fromDirectory, "noop.js");\n\n  const resolveFileName = () =>\n    Module._resolveFilename(moduleId, {\n      id: fromFile,\n      filename: fromFile,\n      paths: Module._nodeModulePaths(fromDirectory),\n    });\n\n  if (silent) {\n    try {\n      return resolveFileName();\n    } catch (error) {\n      return;\n    }\n  }\n\n  return resolveFileName();\n};\n\nmodule.exports = (fromDirectory, moduleId) =>\n  resolveFrom(fromDirectory, moduleId);\nmodule.exports.silent = (fromDirectory, moduleId) =>\n  resolveFrom(fromDirectory, moduleId, true);\n'})}),"\n",(0,n.jsx)(o.p,{children:".silent => \u9759\u9ed8\u65b9\u6cd5 === \u5982\u679c\u6709\u5f02\u5e38\u51fa\u73b0\u7684\u8bdd\u5f02\u5e38\u4e0d\u4f1a\u88ab\u629b\u51fa"}),"\n",(0,n.jsx)(o.h2,{id:"1-\u8ba1\u7b97\u7ed9\u5b9a\u8def\u5f84\u7684\u89c4\u8303\u8def\u5f84\u540d",children:"1. \u8ba1\u7b97\u7ed9\u5b9a\u8def\u5f84\u7684\u89c4\u8303\u8def\u5f84\u540d"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-js",children:"fromDirectory = fs.realpathSync(fromDirectory);\n"})}),"\n",(0,n.jsxs)(o.p,{children:["\u901a\u8fc7",(0,n.jsxs)(o.a,{href:"https://nodejs.cn/api/fs.html#fsrealpathsyncpath-options",children:[(0,n.jsx)(o.code,{children:"fs.realpathSync()"})," \u65b9\u6cd5"]})," \u89e3\u6790\u8ba1\u7b97\u89c4\u8303\u8def\u5f84\u540d"]}),"\n",(0,n.jsx)(o.h2,{id:"2-\u83b7\u53d6\u6240\u6709\u53ef\u80fd\u7684-node_modules-\u8def\u5f84",children:"2. \u83b7\u53d6\u6240\u6709\u53ef\u80fd\u7684 node_modules \u8def\u5f84"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-js",children:"paths: Module._nodeModulePaths(fromDirectory);\n"})}),"\n",(0,n.jsxs)(o.p,{children:["\u901a\u8fc7 ",(0,n.jsx)(o.code,{children:"Module._nodeModulePaths"})," \u5185\u7f6e\u65b9\u6cd5\u83b7\u53d6\u5f53\u524d\u76ee\u5f55\u4e0b\u6240\u6709\u53ef\u80fd\u7684 ",(0,n.jsx)(o.code,{children:"node_modules"})," \u8def\u5f84"]}),"\n",(0,n.jsx)(o.h2,{id:"3-\u83b7\u53d6\u7edd\u5bf9\u8def\u5f84",children:"3. \u83b7\u53d6\u7edd\u5bf9\u8def\u5f84"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-js",children:"const resolveFileName = () =>\n  Module._resolveFilename(moduleId, {\n    id: fromFile,\n    filename: fromFile,\n    paths: Module._nodeModulePaths(fromDirectory),\n  });\n\nreturn resolveFileName();\n"})}),"\n",(0,n.jsxs)(o.p,{children:["\u901a\u8fc7\u6267\u884c ",(0,n.jsx)(o.code,{children:"Module._resolveFilename()"})," \u65b9\u6cd5\u8fd4\u56de\u7edd\u5bf9\u8def\u5f84"]}),"\n",(0,n.jsx)(o.h2,{id:"\u9644module_nodemodulepaths-\u548c-module_resolvefilename-\u7684\u6267\u884c\u6d41\u7a0b",children:"\u9644\uff1aModule._nodeModulePaths \u548c Module._resolveFilename \u7684\u6267\u884c\u6d41\u7a0b"})]})}function u(e={}){const{wrapper:o}={...(0,l.a)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},1151:(e,o,r)=>{r.d(o,{Z:()=>d,a:()=>t});var n=r(7294);const l={},s=n.createContext(l);function t(e){const o=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),n.createElement(s.Provider,{value:o},e.children)}}}]);